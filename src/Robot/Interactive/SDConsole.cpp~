#include "SDConsole.h"


void SDConsole::init() {
  SmartDashboard::PutBoolean("luaConsole_fresh", false);
  SmartDashboard::PutString("luaConsole_input", "");
  SmartDashboard::PutBoolean("luaFile_fresh", false);
  SmartDashboard::PutString("luaFile_name", "");
}

void SDConsole::update(lua_State *luastate) {
  if (SmartDashboard::GetBoolean("luaConsole_fresh")) {
    cout << "lua> " << SmartDashboard::GetString("luaConsole_input") << "\n";
    int errorcode = luaL_dostring(luastate, SmartDashboard::GetString("luaConsole_input").c_str());
    if (errorcode > 0) {
      cout << "error code: " << errorcode << "\n";
      cout << "error message: " << lua_tolstring(luastate, -1, NULL) << "\n";
      lua_settop(luastate, 0);
    }
    SmartDashboard::PutBoolean("luaConsole_fresh", false);
  }
  if (SmartDashboard::GetBoolean("luaFile_fresh")) {
    cout << "luaFile> " << SmartDashboard::GetString("luaFile_name") << "\n";
    int errorcode = luaL_dofile(luastate, ("/lua/"+SmartDashboard::GetString("luaFile_name")+".lua").c_str());
    if (errorcode > 0) {
      cout << "error code: " << errorcode << "\n";
      cout << "error message: " << lua_tolstring(luastate, -1, NULL) << "\n";
      lua_settop(luastate, 0);
    }
    SmartDashboard::PutBoolean("luaFile_fresh", false);
  }
}
